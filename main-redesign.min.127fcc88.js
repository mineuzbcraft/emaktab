define("common/dnevnik",[],function(){"use strict";var o=window.dnevnik||{};o.namespace=function(t){var n=o,e=t.split("."),i,a;if(e[0]==="dnevnik"){e=e.slice(1)}for(i=0,a=e.length;i<a;i+=1){if(typeof n[e[i]]==="undefined"){n[e[i]]={}}n=n[e[i]]}return n};window.dnevnik=o;window.yandex_metrika_callbacks=window.yandex_metrika_callbacks||[];return o});define("common/pubsub",[],function(){"use strict";var t=dnevnik.pubsub={};t.subscribers={};t.subscribe=function(t,n){if(!this.subscribers[t]){this.subscribers[t]=[]}this.subscribers[t].push(n)};t.publish=function(t,n){var e=this.subscribers[t],i,a;if(!e){return}for(i=0,a=e.length;i<a;i+=1){e[i](n)}}});define("async/polling",["common/dnevnik"],function(){"use strict";function t(){var e=1e3;var i=0;var t=1;var n=2;var a=3;var o=4;var s=5;var r;var l;var c;var d=function(t){var n=t.taskStatus;if(n===a){if(l&&r.success){r.success()}l=false}if(n===o||n===i||n===s){l=false;if(r.error){r.error(t)}}if(l){setTimeout(function(){h(r)},e)}};var u=function(t,n){if(n&&t&&n.status===403){window.location.replace(t)}else if(r.error){r.error(n)}};var h=function(n){$.ajax({type:"GET",url:n.taskStateHandlerUrl,dataType:"json",async:n.async===undefined?true:n.async,data:{a:"gts",tid:n.taskID}}).done(n.requestCompleted?n.requestCompleted:d).fail(function(t){u(n.loginUrl,t)})};var f=function(t){r=t;c=r.taskID;l=true;h(t)};var v=function(){l=false;c=undefined};var g=function(){return c};var m=function(){return l};return{start:f,cancel:v,status:{TASK_STATUS_UNDEFINED:i,TASK_STATUS_PENDING:t,TASK_STATUS_EXECUTING:n,TASK_STATUS_COMPLETED:a,TASK_STATUS_ERROR:o},getTaskId:g,isPolling:m,request:h}}var n=t();n.ctor=t;return n});define("controls/utils",["common/dnevnik"],function(){"use strict";dnevnik.namespace("dnevnik.common.controls");dnevnik.common.controls.Dictionaries={BuildList:function(t){var n,e=['<option value="" >-  '+t.label+"  -</option>"];for(n=0;n<t.list.length;n+=1){e.push('<option value="'+t.list[n].Id+'" data-type="'+t.list[n].Type+'">'+t.list[n].Name+"</option>")}return e.join("")}}});define("controls/cityselectbox",["common/dnevnik","controls/utils"],function(){"use strict";dnevnik.namespace("dnevnik.common.controls");dnevnik.common.controls.ChainedSelectInput=function(t){this.o=$.extend({},this.defaults,t);this.init()};dnevnik.common.controls.ChainedSelectInput.prototype={defaults:{el:null,next:null,change:null,label:"Загрузка...",ajaxUrl:null},init:function(){this._onChange=$.proxy(this.onChange,this);this._clear=$.proxy(this.clear,this);this._onParantChanged=$.proxy(this.onParantChanged,this);this._LoadList=$.proxy(this.LoadList,this);this.el=$(this.o.el+"_Select");this.next=$(this.o.next+"_Select");this.hidden=$(this.o.el);this.el.bind("change",this._onChange);this.el.bind("csi:parantchanged",this._onParantChanged);this.el.bind("csi:clear",this._clear)},onChange:function(t){this.hidden.val(this.el.val());var n=true;if(this.o.change){n=this.o.change(t,this)}if(n){this.next.trigger("csi:parantchanged",this.el.val())}},onParantChanged:function(t,n){if(n){this.LoadList(n,null);if(this.next){this.next.trigger("csi:clear")}}else{this.clear()}},LoadList:function(t,e,i){this.el.empty().attr("disabled","disabled").append('<option value="">'+this.o.label+"</option>").parent().show();var a=this;$.post(this.o.ajaxUrl,{id:t},function(t){a.el.html(dnevnik.common.controls.Dictionaries.BuildList(t)).removeAttr("disabled");if(e){var n=i?'option[value= "'+e+'"][data-type="'+i+'"]':'option[value= "'+e+'"]';a.el.find(n).attr("selected",true);a.hidden.val(e)}},"json")},clear:function(){this.hidden.val(null);this.el.empty().parent().hide();if(this.next){this.next.trigger("csi:clear")}}};dnevnik.common.controls.CitySelectBox=function(t){this.o=$.extend({},this.defaults,t);this.init(this.o)};dnevnik.common.controls.CitySelectBox.prototype={defaults:{ajaxUrl:null,baseElId:"CitySelectBox",label:"Загрузка...",useCityRegion:false},init:function(i){this.cityRegion=i.useCityRegion&&new dnevnik.common.controls.ChainedSelectInput({el:"#"+i.baseElId+"_CityRegionId",ajaxUrl:i.ajaxUrl+"/cityregionlist"});this.city=new dnevnik.common.controls.ChainedSelectInput({el:"#"+i.baseElId+"_CityId",next:i.useCityRegion?"#"+i.baseElId+"_CityRegionId":null,ajaxUrl:i.ajaxUrl+"/citylist"});var a=this;this.childRegion=new dnevnik.common.controls.ChainedSelectInput({el:"#"+i.baseElId+"_ChildRegionId",next:"#"+i.baseElId+"_CityId",ajaxUrl:i.ajaxUrl+"/cityandregionlist",change:function(t,n){var e=n.el.val();n.hidden.val(e);if(e&&n.el.find(":selected").data("type")==="city"){n.next.trigger("csi:clear");n.hidden.val(null);a.city.hidden.val(e);if(i.useCityRegion){a.cityRegion.el.trigger("csi:parantchanged",e)}return false}return true}});this.region=new dnevnik.common.controls.ChainedSelectInput({el:"#"+i.baseElId+"_RegionId",next:"#"+i.baseElId+"_ChildRegionId",ajaxUrl:i.ajaxUrl+"/regionlist"});this.country=new dnevnik.common.controls.ChainedSelectInput({el:"#"+i.baseElId+"_CountryId",next:"#"+i.baseElId+"_RegionId",ajaxUrl:i.ajaxUrl+"/countrylist"})},select:function(t){if(t.Visible===false){return}this.country.LoadList(null,t.CountryId);if(t.RegionId){this.region.LoadList(t.CountryId,t.RegionId)}if(t.ChildRegionId){this.childRegion.LoadList(t.RegionId,t.ChildRegionId,"region")}if(t.CityId){if(t.ChildRegionId){this.city.LoadList(t.ChildRegionId,t.CityId)}else{this.city.LoadList(t.RegionId,t.CityId,"city")}}if(this.o.useCityRegion&&t.CityRegionId){this.cityRegion.LoadList(t.CityId,t.CityRegionId)}},values:function(){var t={};t[this.country.hidden.attr("name")]=this.country.hidden.val();t[this.region.hidden.attr("name")]=this.region.hidden.val();t[this.childRegion.hidden.attr("name")]=this.childRegion.hidden.val();t[this.city.hidden.attr("name")]=this.city.hidden.val();if(this.o.useCityRegion){t[this.cityRegion.hidden.attr("name")]=this.cityRegion.hidden.val()}return t}}});define("controls/datetimebox",["common/dnevnik"],function(){"use strict";dnevnik.namespace("dnevnik.common.controls");dnevnik.common.controls.DateTimeBox=function(t,n,e){var i={months:$.d.calendar.localization.lang.months,months_short:$.d.calendar.localization.lang.shortMonths,isHebrew:$.d.calendar.localization.lang.isHebrew,isArabic:$.d.calendar.localization.lang.isArabic,weekdays_short:$.d.calendar.localization.lang.weekdays_short,todayLabel:$.d.calendar.localization.lang.todayLabel};if(n.TodayDate){i.todayDate=n.TodayDate}if(n.FromDate){i.fromDate=n.FromDate}if(n.ToDate){i.toDate=n.ToDate}if(n.StartScreen){i.startScreen=n.StartScreen}if(n.Mode==="ButtonWithRedirect"){var a=n.UrlForButtonWithRedirect.indexOf("?")<0?n.UrlForButtonWithRedirect+"?var":n.UrlForButtonWithRedirect;i.onDateSelected=function(t){window.location.href=a+"&year="+t.year+"&month="+t.month+"&day="+t.day}}else{i.onDateSelected=e?e:function(){return false}}$("#"+t).calendar(i);if(n.Mode==="ButtonWithRedirect"){$("#"+t+"_button").click(function(){$("#"+t).click()})}}});define("controls/captcha",["common/dnevnik"],function(){"use strict";return function(a){var t=document,o=t.getElementById(a.id),n=o.getElementsByClassName(a.refreshButton)[0];function e(){var t=s(),n=o.getElementsByClassName(a.valueField)[0],e=o.getElementsByClassName(a.inputField)[0],i=o.getElementsByClassName(a.imageChild)[0];e.value="";n.value=t;setTimeout(function(){i.src=a.imagePart+t},100)}function s(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=Math.random()*16|0,e=t==="x"?n:n&3|8;return e.toString(16)})}e();n.addEventListener("click",function(){e()},false)}});define("controls/input_phone",[],function(){"use strict";return function(t){var n=t.id,e=document,a=e.getElementById(n),i="+7 ( <%= this[0] %><%= this[1] %><%= this[2] %> ) <%= this[3] %><%= this[4] %><%= this[5] %><%= this[6] %><%= this[7] %><%= this[8] %><%= this[9] %>",o=t.template||i,s=o.indexOf("<%= this[0] %>"),r=t.phoneLength||10;o=_.template(o);function l(){return a.value.substring(s,a.selectionStart).replace(/\D/g,"").length}function c(t){return t.substring(s)}function d(t,n){var e=Array.from(c(t).matchAll(/[\d]/g)).map(function(t){return t.index});if(a.selectionEnd<=s||e.length===0){return s}var i=e[n-1];return i+1+s}function u(t){a.setSelectionRange(t,t)}function h(t){var n=l();var e=d(t.target.value,n);u(e)}function f(t){t=t||r;return new Array(t).join(" ")}if(a.value.length>r){a.setAttribute("value",o.call(a.value.substring(a.value.length-r)))}else{a.setAttribute("value",o.call(f()))}function v(){var t=c(a.value).replace(/\D/g,"");var n=l();var e,i;if(t.length>r){e=o.call(t.substring(0,r))}else{e=o.call(t.concat(f(r-t.length)))}if(n>r){i=e.length}else{i=d(e,n)}a.value=e;u(i)}a.addEventListener("focus",h);a.addEventListener("click",h);a.addEventListener("keydown",h);a.addEventListener("input",v)}});define("controls/dictionaries",[],function(){"use strict";return function(t){var n=document,e=t.ajaxUrl,i=t.errorText,a=n.getElementById("outype"),o=n.getElementById("ouclass"),s=n.getElementById("eduOrgclass"),r,l;r=function(){l()};l=function(){var t=a.value;var n=dnevnik.dialogs;$.ajax({type:"Post",url:e,dataType:"json",data:{a:"eoclass",eotid:t},success:function(t){if(!t.isOrgTypeNew){s.classList.remove("orgclass_hidden")}else{s.classList.add("orgclass_hidden")}o.innerHTML=t.list},error:function(){n.error(i)}})};a.addEventListener("change",r)}});define("controls/controls",["controls/utils","controls/cityselectbox","controls/datetimebox","controls/captcha","controls/input_phone","controls/dictionaries"],function(){"use strict"});define("analytics/events",["common/dnevnik"],function(){"use strict";$.fn.live=$.fn.live||$.fn.on;$(document).ready(function(){$(".trackable").on("click","",function(t){var n=t.currentTarget,e=n.getAttribute("data-id"),i=n.getAttribute("data-action"),a=n.getAttribute("data-category");dnevnik.analytics.track({category:a,action:i,label:e})})})});define("analytics/yaMetrikaTracker",[],function(){"use strict";var e=function(e,i){var t=dnevnik.settings.yandexMetrikaIds;var a=window.yandex_metrika_callbacks;t.forEach(t=>{var n="yaCounter"+t;if(!a&&!(window[n]&&window[n][e])){a=window.yandex_metrika_callbacks=[]}if(window[n]&&window[n][e]){window[n][e](i)}else if(a){a.push(function(){window[n][e](i)})}})};return{reachGoal:function(t){var n=t.target;if(n){e("reachGoal",n)}},params:function(t){e("params",t)},getClientId:function(t){e("getClientID",t)}}});define("analytics/analytics",["common/dnevnik","analytics/events","analytics/yaMetrikaTracker"],function(){"use strict";var t=arguments[0],n=arguments[2];t.namespace("dnevnik.analytics");t.analytics=function(){return{yandex:{reachGoal:function(t){if(n.reachGoal){n.reachGoal(t)}},params:function(t){if(n.params){n.params(t)}}}}}()});require(["common/dnevnik","common/pubsub","async/polling","controls/controls","analytics/analytics"],function(){"use strict";$.ajaxSetup({cache:false})});define("main-redesign",function(){});